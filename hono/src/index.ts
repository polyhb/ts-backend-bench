import authors from './routes/authors';
import books from './routes/books';
import { openAPISpecs } from 'hono-openapi';
import { apiReference } from '@scalar/hono-api-reference';
import { OpenAPIHono } from '@hono/zod-openapi';
import { hc } from 'hono/client';

const app = new OpenAPIHono().route('/authors', authors).route('/books', books);

// Generated by https://hono.dev/examples/zod-openapi
app.doc('/doc', {
  openapi: '3.0.0',
  info: {
    version: '1.0.0',
    title: 'My API'
  }
});

// Generated by Hono OpenAPI
app.get(
  '/openapi',
  openAPISpecs(app, {
    documentation: {
      info: { title: 'Hono API', version: '1.0.0', description: 'Poly API' },
      servers: [{ url: 'http://localhost:3000', description: 'Local Server' }]
    }
  })
);

// Scalar website using OpenAPI
// http://localhost:3000/reference
app.get(
  '/reference',
  apiReference({
    spec: {
      // Change to /doc or /openapi to see the difference
      url: '/doc'
    }
  })
);

const client = hc<typeof app>('http://localhost:3000/');

// front client works !
client.authors[':id']
  .$put({ param: { id: '123' }, json: { age: 42 } })
  .then((res) => res.json())
  .then(console.log);

export default app;
